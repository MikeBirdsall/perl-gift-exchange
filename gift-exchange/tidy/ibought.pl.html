<!-- Generated by perltidy on Mon Jan 20 23:45:26 2003 -->
    <HTML> 
	<HEAD> 
	    <TITLE>multilist - cgi-bin program for managing lists of gifts

</TITLE> 
	</HEAD>

<style type="text/css">
<!--
/* default style sheet generated by perltidy */
body {background: #FFFFFF; color: #000000}
pre { color: #000000; 
      background: #FFFFFF;
      font-family: courier;
    } 

.c  { color: #228B22;} /* comment */
.cm { color: #000000;} /* comma */
.co { color: #000000;} /* colon */
.h  { color: #CD5555; font-weight:bold;} /* here-doc-target */
.hh { color: #CD5555; font-style:italic;} /* here-doc-text */
.i  { color: #00688B;} /* identifier */
.j  { color: #CD5555; font-weight:bold;} /* label */
.k  { color: #8B008B; font-weight:bold;} /* keyword */
.m  { color: #FF0000; font-weight:bold;} /* subroutine */
.n  { color: #B452CD;} /* numeric */
.p  { color: #000000;} /* paren */
.pd { color: #228B22; font-style:italic;} /* pod-text */
.pu { color: #000000;} /* punctuation */
.q  { color: #CD5555;} /* quote */
.s  { color: #000000;} /* structure */
.sc { color: #000000;} /* semicolon */
.v  { color: #B452CD;} /* v-string */
.w  { color: #000000;} /* bareword */
-->
</style>
	<BODY>
<a name="-top-"></a>
<h1>ibought.pl</h1>

<!-- INDEX BEGIN -->

<UL>

	<LI><A HREF="#NAME">NAME</A>
	<LI><A HREF="#VERSION">VERSION</A>
	<LI><A HREF="#SYNOPSIS">SYNOPSIS</A>
	<LI><A HREF="#DESCRIPTION">DESCRIPTION</A>
	<UL>

		<LI><A HREF="#Overview">Overview</A>
		<LI><A HREF="#Input_paramters">Input paramters</A>
		<LI><A HREF="#Any_other_information_that_s_imp">Any other information that's important</A>
	</UL>

	<LI><A HREF="#ENVIRONMENT">ENVIRONMENT</A>
	<LI><A HREF="#DIAGNOSTICS">DIAGNOSTICS</A>
	<LI><A HREF="#BUGS">BUGS</A>
	<LI><A HREF="#REFACTORINGS">REFACTORINGS</A>
	<LI><A HREF="#SUGGESTED_ENHANCEMENTS">SUGGESTED ENHANCEMENTS</A>
	<LI><A HREF="#FILES">FILES</A>
	<LI><A HREF="#SEE_ALSO">SEE ALSO</A>
	<LI><A HREF="#AUTHOR">AUTHOR</A>
	<LI><A HREF="#COPYRIGHT">COPYRIGHT</A>
</UL>
<!-- INDEX END -->
<h2>Code Index:</h2>
<!-- BEGIN CODE INDEX --><a name="code-index"></a>
<ul>
<li><a href="#paint_style_menu-">package main</a>
<ul>
<li><a href="#paint_style_menu-">paint_style_menu</a></li>
<li><a href="#stylefile-">stylefile</a></li>
<li><a href="#display_name-">display_name</a></li>
<li><a href="#paint_footer-">paint_footer</a></li>
<li><a href="#error_page-">error_page</a></li>
<li><a href="#push_item-">push_item</a></li>
<li><a href="#paint_wishlist-">paint_wishlist</a></li>
<li><a href="#all_wishlists-">all_wishlists</a></li>
<li><a href="#attributes_for-">attributes_for</a></li>
</ul>
</li>
<li><a href="#__END__-">__END__</a></li>
<li><a href="#EOF-">EOF</a></li>
</ul>
<!-- END CODE INDEX -->

<HR>

<P>
<HR>
<H1><A NAME="NAME">NAME

</A></H1>
multilist - cgi-bin program for managing lists of gifts


<P>

<P>
<HR>
<H1><A NAME="VERSION">VERSION

</A></H1>
This document refers to version $Name: $ 0.50 of wishlist, released Aug 24,
2002.


<P>

<P>
<HR>
<H1><A NAME="SYNOPSIS">SYNOPSIS

</A></H1>
<PRE>    wishlist [user=&lt;user&gt;] [owner=&lt;owner&gt;] [action=&lt;action&gt;]
</PRE>

<P>

<P>
<HR>
<H1><A NAME="DESCRIPTION">DESCRIPTION

</A></H1>
<P>
<HR>
<H2><A NAME="Overview">Overview

</A></H2>
<P>
<HR>
<H2><A NAME="Input_paramters">Input paramters

</A></H2>
<PRE>    owner
    user
    action
    description
    wanted
    debug
</PRE>

<P>

<P>
<HR>
<H2><A NAME="Any_other_information_that_s_imp">Any other information that's important

</A></H2>
<P>
<HR>
<H1><A NAME="ENVIRONMENT">ENVIRONMENT

</A></H1>
REMOTE_USER - the login ID of the individual running the program.


<P>

<P>
<HR>
<H1><A NAME="DIAGNOSTICS">DIAGNOSTICS

</A></H1>
<DL>
<DT><STRONG><A NAME="item__You">"You are not properly logged in

</A></STRONG><DD>
This message will be printed on the page when we cannot detect the remote
user environment form. That means that either the web site was not set up
with security, so the user is not logged in and is unidentified, or that
the program is being run interactively without the REMOTE_USER environment
variable set.


<P>

<DT><STRONG><A NAME="item__Repository">"Repository <dirname> does not exist."

</A></STRONG><DD>
The repository for all of the data-files is expected in directory
&lt;dirname&gt; and the program cannot locate that directory.


<P>

</DL>
<P>
<HR>
<H1><A NAME="BUGS">BUGS

</A></H1>
<DL>
<DT><STRONG><A NAME="item_None">None currently identified

</A></STRONG><DD>
</DL>
<P>
<HR>
<H1><A NAME="REFACTORINGS">REFACTORINGS

</A></H1>
No refactorings currently identified


<P>

<P>
<HR>
<H1><A NAME="SUGGESTED_ENHANCEMENTS">SUGGESTED ENHANCEMENTS

</A></H1>
<DL>
<DT><STRONG><A NAME="item_Return">Return Control

</A></STRONG><DD>
Add a control for each page to return to the main menu (back to
mbirdsall.com? or back to mbirdsall.com/family/)


<P>

<DT><STRONG><A NAME="item_Redraw">Redraw Control

</A></STRONG><DD>
Add a control to redraw the screen, and make the style immediately visible.


<P>

<DT><STRONG><A NAME="item_Edit">Edit or Undo Purchases

</A></STRONG><DD>
Allow a purchaser to renege on a purchase - putting it back in the list as
available - or to change their public or private note.


<P>

<DT><STRONG><A NAME="item_Expiration">Expiration date

</A></STRONG><DD>
Allow a suggester (particularly the owner) to put an expiration date on the
item, after which time he is free to buy it himself.


<P>

<DT><STRONG><A NAME="item_Retrieving">Retrieving password

</A></STRONG><DD>
Send lost passwords out the stored e-mail address.


<P>

<DT><STRONG><A NAME="item_Personal">Personal Control Panel

</A></STRONG><DD>
Create a Control Panel for each user where the user can change such things
as


<P>

<PRE>    Screen color preferences
    Full Name
    email address
    Password
    Clothing Sizes
    Defaults
        expiration date
    Occasions
        Birthdays, Holidays, Anniversaries, ...
    Watch List
        People to be notified about
</PRE>

<P>

<DT><STRONG><A NAME="item_Change">Change date-times to UTC

</A></STRONG><DD>
<DT><STRONG><A NAME="item_Help">Help screens

</A></STRONG><DD>
<DT><STRONG><A NAME="item_Print">Print Friendly Page and Print Button

</A></STRONG><DD>
<DT><STRONG><A NAME="item_URLs">URLs in suggestions

</A></STRONG><DD>
<DT><STRONG><A NAME="item_Public">Public Suggestions

</A></STRONG><DD>
Allow suggestions to be marked as visible for owner


<P>

<DT><STRONG><A NAME="item_E">E-Mail Notifications

</A></STRONG><DD>
</DL>
<P>
<HR>
<H1><A NAME="FILES">FILES

</A></H1>
<P>
<HR>
<H1><A NAME="SEE_ALSO">SEE ALSO

</A></H1>
<P>
<HR>
<H1><A NAME="AUTHOR">AUTHOR

</A></H1>
Michael G. Birdsall


<P>

<P>
<HR>
<H1><A NAME="COPYRIGHT">COPYRIGHT

</A></H1>
Copyright (c) 2002, Michael G. Birdsall. All Rights Reserved. This module
is free software. It may be used, redistributed and/or modified under the
same terms as Perl itself.


<P>

</DL>
<hr /><pre>#!/usr/local/bin/perl
<span class="c"># $Id: ibought.pl,v 1.6 2002/09/20 21:47:55 mbirdsal Exp $</span>

<span class="c"># This CGI-BIN perl script is part of the suite for Wish lists.</span>
<span class="c"># This script reports to a specific person all of the gifts they have marked for buying</span>
<span class="c"># in every wish list.</span>
<span class="c">#</span>
<span class="c"># The following line is useful to cut and paste for debugging purposes. </span>
<span class="c">#if ($debug) {print h2({-class=&gt;'Debug'}, &quot;Line &quot; , __LINE__, &quot; module &quot; , (caller(0))[3])}</span>

<span class="k">use</span> <span class="w">lib</span> <span class="q">'/big/dom/xkirkbird/lib/perl5/site_perl/5.005/'</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">CGI</span> <span class="q">':standard'</span><span class="cm">,</span> <span class="q">':html3'</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">CGI::Carp</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">CGI</span> <span class="q">qw/escapeHTML unescapeHTML/</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">POSIX</span> <span class="q">'strftime'</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">Fcntl</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">Christmas::Wishlist</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>

<span class="k">my</span> <span class="i">$debug</span> = <span class="i">param</span><span class="s">(</span><span class="q">'debug'</span><span class="s">)</span><span class="sc">;</span>

<span class="c">#my $debug = 1;</span>

<span class="c">#_____________________________________________________________________________</span>
<span class="c"># Closure for style definitions - these all manipulate styles</span>
<span class="s">{</span>
    <span class="k">my</span> <span class="i">$style_prefix</span> = <span class="q">&quot;/css/wls_&quot;</span><span class="sc">;</span>

    <span class="c">#</span>
    <span class="c"># paint_style_menu</span>
    <span class="c">#     prints the html for the menu to choose styles</span>
<a name="paint_style_menu-"></a>    <span class="k">sub </span><span class="m">paint_style_menu</span>
    <span class="s">{</span>

        <span class="k">print</span> <span class="i">br</span><span class="cm">,</span> <span class="i">p</span><span class="s">(</span><span class="q">&quot;Choose style for pages&quot;</span><span class="s">)</span><span class="sc">;</span>
        <span class="k">print</span> <span class="i">popup_menu</span><span class="s">(</span>
            -<span class="w">name</span>   <span class="cm">=&gt;</span> <span class="q">'style'</span><span class="cm">,</span>
            -<span class="w">values</span> <span class="cm">=&gt;</span> <span class="s">[</span>
                <span class="q">&quot;&quot;</span><span class="cm">,</span>
                <span class="k">map</span> <span class="s">{</span> <span class="q">m[\.\.${style_prefix}(\w+)\.css]</span> <span class="s">}</span>
                  <span class="k">glob</span><span class="s">(</span><span class="q">&quot;..${style_prefix}*.css&quot;</span><span class="s">)</span>
            <span class="s">]</span><span class="cm">,</span>
        <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>

    <span class="c">#</span>
    <span class="c"># stylefile</span>
    <span class="c">#     Returns a string containing the file with the css style for the style</span>
    <span class="c">#     parameter chosen</span>
<a name="stylefile-"></a>    <span class="k">sub </span><span class="m">stylefile</span>
    <span class="s">{</span>
        <span class="k">return</span> <span class="i">$style_prefix</span> . <span class="s">(</span> <span class="i">param</span><span class="s">(</span><span class="q">'style'</span><span class="s">)</span> || <span class="q">'default'</span> <span class="s">)</span> . <span class="q">'.css'</span><span class="sc">;</span>
    <span class="s">}</span>
<span class="s">}</span>

<span class="c">#_____________________________________________________________________________</span>
<span class="c"># Set the initial data</span>
<span class="c"># The following two variables, $gltitle and $glrepository, are actually used as</span>
<span class="c"># global variables. They are the only two in this program. Consider getting rid</span>
<span class="c"># of them, and maybe making a closure to get rid of all globals.</span>

<span class="k">my</span> <span class="i">$glrepository</span> =
  <span class="s">(</span> <span class="i">$ENV</span>{<span class="w">HOME</span>} || <span class="i">$ENV</span>{<span class="w">LOGDIR</span>} || <span class="s">(</span> <span class="k">getpwuid</span><span class="s">(</span><span class="i">$&gt;</span><span class="s">)</span> <span class="s">)</span>[<span class="n">7</span>] <span class="s">)</span>
  . <span class="q">&quot;/wishlistdata/family/&quot;</span><span class="sc">;</span>

<span class="k">my</span> <span class="i">$gluser</span> = <span class="i">remote_user</span><span class="s">(</span><span class="s">)</span>
  || <span class="i">error_page</span><span class="s">(</span><span class="q">&quot;You are not properly logged in.&quot;</span><span class="s">)</span><span class="sc">;</span>

<span class="k">my</span> <span class="i">$gltitle</span> = <span class="q">'Hello '</span>
  . <span class="i">display_name</span><span class="s">(</span><span class="i">$gluser</span><span class="s">)</span>
  . <span class="q">'! You Are On the Page To View Items You have Bought'</span><span class="sc">;</span>

<span class="w">Christmas::Wishlist</span><span class="i">-&gt;set_repository</span><span class="s">(</span><span class="i">$glrepository</span><span class="s">)</span>
  <span class="k">or</span> <span class="i">error_page</span><span class="s">(</span><span class="q">&quot;Repository $glrepository does not exist.&quot;</span><span class="s">)</span><span class="sc">;</span>

<span class="k">print</span> <span class="i">header</span><span class="cm">,</span>
  <span class="i">start_html</span><span class="s">(</span>
    -<span class="w">title</span> <span class="cm">=&gt;</span> <span class="i">$gltitle</span><span class="cm">,</span>
    -<span class="w">style</span> <span class="cm">=&gt;</span> <span class="s">{</span> -<span class="w">src</span> <span class="cm">=&gt;</span> <span class="i">stylefile</span><span class="s">(</span><span class="s">)</span> <span class="s">}</span>
  <span class="s">)</span><span class="sc">;</span>

<span class="k">if</span> <span class="s">(</span><span class="i">$debug</span><span class="s">)</span> <span class="s">{</span> <span class="k">print</span> <span class="i">h2</span><span class="s">(</span> <span class="s">{</span> -<span class="w">class</span> <span class="cm">=&gt;</span> <span class="q">'Debug'</span> <span class="s">}</span><span class="cm">,</span> <span class="q">&quot;Repository at $glrepository&quot;</span> <span class="s">)</span> <span class="s">}</span>

<span class="c"># Set $owner to all possible wishlists, so we check them all</span>
<span class="k">my</span> <span class="i">@owner</span> = <span class="i">all_wishlists</span><span class="s">(</span><span class="i">$gluser</span><span class="s">)</span><span class="sc">;</span>

<span class="i">paint_wishlist</span><span class="s">(</span> <span class="i">$gluser</span><span class="cm">,</span> <span class="i">@owner</span> <span class="s">)</span><span class="sc">;</span>
<span class="i">paint_style_menu</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
<span class="k">print</span> <span class="i">end_form</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
<span class="k">print</span> <span class="i">end_html</span><span class="sc">;</span>

<span class="c">#_____________________________________________________________________________</span>
<span class="c">#</span>
<span class="c"># display_name</span>
<span class="c">#     returns the display name given the login-id</span>
<a name="display_name-"></a><span class="k">sub </span><span class="m">display_name</span>
<span class="s">{</span>

    <span class="k">return</span> <span class="i">attributes_for</span><span class="s">(</span> <span class="i">$_</span>[<span class="n">0</span>]<span class="cm">,</span> <span class="q">'name'</span> <span class="s">)</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#_____________________________________________________________________________</span>
<span class="c">#</span>
<span class="c"># paint_footer</span>
<span class="c">#    paints a set of submits (normally) at the bottom of the screen</span>
<span class="c">#    which does the standard control for a screen</span>
<a name="paint_footer-"></a><span class="k">sub </span><span class="m">paint_footer</span>
<span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$command</span><span class="cm">,</span> <span class="i">@command</span> <span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">print</span> <span class="i">hidden</span><span class="s">(</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">'lastaction'</span><span class="cm">,</span> -<span class="w">value</span> <span class="cm">=&gt;</span> <span class="i">$command</span><span class="cm">,</span> -<span class="w">override</span> <span class="cm">=&gt;</span> <span class="n">1</span> <span class="s">)</span>
      <span class="k">if</span> <span class="k">defined</span> <span class="i">$command</span><span class="sc">;</span>

    <span class="k">foreach</span> <span class="i">$command</span> <span class="s">(</span><span class="i">@command</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">print</span> <span class="i">submit</span><span class="s">(</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">'action'</span><span class="cm">,</span> -<span class="w">value</span> <span class="cm">=&gt;</span> <span class="i">$command</span> <span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">print</span> <span class="i">submit</span><span class="s">(</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">'dummy'</span><span class="cm">,</span> -<span class="w">value</span> <span class="cm">=&gt;</span> <span class="q">'Redraw the screen'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">print</span> <span class="i">button</span><span class="s">(</span>
        -<span class="w">value</span>   <span class="cm">=&gt;</span> <span class="q">&quot;Family Page&quot;</span><span class="cm">,</span>
        -<span class="w">onClick</span> <span class="cm">=&gt;</span> <span class="q">&quot;window.location='index.html'&quot;</span>
    <span class="s">)</span><span class="sc">;</span>
    <span class="k">print</span> <span class="i">button</span><span class="s">(</span> -<span class="w">value</span> <span class="cm">=&gt;</span> <span class="q">&quot;Print Page&quot;</span><span class="cm">,</span> -<span class="w">onClick</span> <span class="cm">=&gt;</span> <span class="q">&quot;window.print()&quot;</span> <span class="s">)</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#_____________________________________________________________________________</span>
<span class="c">#</span>
<span class="c"># error_page fills in the html page with an error message when there is an error</span>
<span class="c"># which prevents further processing</span>
<span class="c">#</span>
<a name="error_page-"></a><span class="k">sub </span><span class="m">error_page</span>
<span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$error</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">print</span> <span class="i">header</span><span class="cm">,</span>
      <span class="i">start_html</span><span class="s">(</span>
        -<span class="w">title</span> <span class="cm">=&gt;</span> <span class="q">&quot;Wishlist Error Notification&quot;</span><span class="cm">,</span>
        -<span class="w">style</span> <span class="cm">=&gt;</span> <span class="s">{</span> -<span class="w">src</span> <span class="cm">=&gt;</span> <span class="i">stylefile</span><span class="s">(</span><span class="s">)</span> <span class="s">}</span>
      <span class="s">)</span><span class="sc">;</span>
    <span class="k">print</span> <span class="i">h1</span><span class="s">(</span> <span class="s">{</span> -<span class="w">class</span> <span class="cm">=&gt;</span> <span class="q">'Warning'</span> <span class="s">}</span><span class="cm">,</span> <span class="i">$error</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">print</span> <span class="i">end_html</span><span class="sc">;</span>

    <span class="k">exit</span><span class="sc">;</span>

<span class="s">}</span>

<span class="c">#_____________________________________________________________________________</span>
<span class="c">#</span>
<span class="c"># push_item</span>
<span class="c"># pushes a table entry for an item formatted for the owner of the list to view</span>
<a name="push_item-"></a><span class="k">sub </span><span class="m">push_item(\@$$)</span>
<span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$rowref</span><span class="cm">,</span> <span class="i">$item</span><span class="cm">,</span> <span class="i">$who</span> <span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">return</span> <span class="k">unless</span> <span class="k">defined</span> <span class="i">$item</span><span class="sc">;</span>
    <span class="k">return</span> <span class="k">if</span> <span class="i">$item</span><span class="i">-&gt;deleted</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">$id</span> = <span class="i">$item</span><span class="i">-&gt;ident</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">push</span> <span class="s">(</span>
        <span class="i">@</span>{<span class="i">$rowref</span>}<span class="cm">,</span>
        <span class="i">td</span><span class="s">(</span> <span class="s">[</span> <span class="i">display_name</span><span class="s">(</span><span class="i">$who</span><span class="s">)</span><span class="cm">,</span> <span class="i">escapeHTML</span><span class="s">(</span> <span class="i">$item</span><span class="i">-&gt;description</span><span class="s">(</span><span class="s">)</span> <span class="s">)</span><span class="cm">,</span> <span class="s">]</span> <span class="s">)</span>
    <span class="s">)</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#_____________________________________________________________________________</span>
<span class="c">#</span>
<span class="c"># paint_wishlist is an &quot;action&quot; routine and the default action item.</span>
<span class="c"># It displays a page with a table showing the list of suggestions</span>
<span class="c"># either formatted for the owner or for anyone else.</span>
<span class="c">#</span>
<a name="paint_wishlist-"></a><span class="k">sub </span><span class="m">paint_wishlist</span>
<span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$user</span><span class="cm">,</span> <span class="i">@owner</span> <span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">my</span> <span class="i">@rows</span><span class="sc">;</span>

    <span class="k">push</span> <span class="s">(</span> <span class="i">@rows</span><span class="cm">,</span> <span class="i">th</span><span class="s">(</span> <span class="s">[</span> <span class="q">'For'</span><span class="cm">,</span> <span class="q">'Description'</span> <span class="s">]</span> <span class="s">)</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$owner</span> <span class="s">(</span><span class="i">@owner</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">my</span> <span class="i">$wl</span> = <span class="w">Christmas::Wishlist</span><span class="i">-&gt;new</span><span class="s">(</span> <span class="w">userid</span> <span class="cm">=&gt;</span> <span class="i">$owner</span> <span class="s">)</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">@items</span> = <span class="i">$wl</span><span class="i">-&gt;get_items</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>

        <span class="k">foreach</span> <span class="k">my</span> <span class="i">$item</span> <span class="s">(</span><span class="i">@items</span><span class="s">)</span> <span class="s">{</span>
            <span class="i">push_item</span><span class="s">(</span> <span class="i">@rows</span><span class="cm">,</span> <span class="i">$item</span><span class="cm">,</span> <span class="i">$owner</span> <span class="s">)</span>
              <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$item</span> <span class="k">and</span> <span class="i">$item</span><span class="i">-&gt;purchased_by</span><span class="s">(</span><span class="i">$user</span><span class="s">)</span> <span class="s">)</span><span class="sc">;</span>
        <span class="s">}</span>

    <span class="s">}</span>

    <span class="k">print</span> <span class="i">startform</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span>
      <span class="i">table</span><span class="s">(</span>
        <span class="s">{</span> -<span class="w">border</span> <span class="cm">=&gt;</span> <span class="q">''</span> <span class="s">}</span><span class="cm">,</span>
        <span class="i">caption</span><span class="s">(</span>
            <span class="i">strong</span><span class="s">(</span>
                <span class="q">&quot;Wish List for &quot;</span><span class="cm">,</span>
                <span class="k">join</span> <span class="s">(</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="k">map</span> <span class="s">{</span> <span class="i">display_name</span><span class="s">(</span><span class="i">$_</span><span class="s">)</span> <span class="s">}</span> <span class="i">@owner</span> <span class="s">)</span>
            <span class="s">)</span>
        <span class="s">)</span><span class="cm">,</span>
        <span class="i">TR</span><span class="s">(</span> \<span class="i">@rows</span> <span class="s">)</span>
      <span class="s">)</span><span class="cm">,</span>
      <span class="w">br</span><span class="cm">,</span> <span class="i">hidden</span><span class="s">(</span> -<span class="w">name</span> <span class="cm">=&gt;</span> <span class="q">'owner'</span> <span class="s">)</span><span class="sc">;</span>
    <span class="i">paint_footer</span><span class="s">(</span><span class="k">undef</span><span class="s">)</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#_____________________________________________________________________________</span>
<span class="c">#</span>
<a name="all_wishlists-"></a><span class="k">sub </span><span class="m">all_wishlists</span>
<span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$user</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">@lists</span><span class="sc">;</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$person</span> <span class="s">(</span> <span class="k">glob</span><span class="s">(</span><span class="q">&quot;$glrepository/person.*&quot;</span><span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$person</span> =~ <span class="q">s[$glrepository/person\.][]</span><span class="sc">;</span>
        <span class="k">push</span> <span class="i">@lists</span><span class="cm">,</span> <span class="i">$person</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span> <span class="i">@lists</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#_____________________________________________________________________________</span>
<span class="c">#</span>
<span class="c"># Routine to read any needed attributes for a particular user.</span>
<span class="c"># The routine should cache any attributes it does get, and return them</span>
<span class="c"># without reading the file.</span>

<a name="attributes_for-"></a><span class="k">sub </span><span class="m">attributes_for</span>
<span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$person</span><span class="cm">,</span> <span class="i">@atts</span> <span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%UserValues</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">@response</span><span class="sc">;</span>

    <span class="k">open</span> <span class="w">PERSON</span><span class="cm">,</span> <span class="q">&quot;$glrepository/person.$person&quot;</span>
      <span class="k">or</span> <span class="k">print</span> <span class="q">&quot;I don't have any information on $person&quot;</span><span class="cm">,</span> <span class="w">br</span><span class="sc">;</span>
    <span class="k">while</span> <span class="s">(</span><span class="q">&lt;PERSON&gt;</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">chomp</span><span class="sc">;</span>
        <span class="q">s/#.*//</span><span class="sc">;</span>
        <span class="q">s/^\s+//</span><span class="sc">;</span>
        <span class="k">next</span> <span class="k">unless</span> <span class="k">length</span><span class="sc">;</span>
        <span class="k">my</span> <span class="s">(</span> <span class="i">$var</span><span class="cm">,</span> <span class="i">$value</span> <span class="s">)</span> = <span class="k">split</span> <span class="s">(</span> <span class="q">/\s*=\s*/</span><span class="cm">,</span> <span class="i">$_</span><span class="cm">,</span> <span class="n">2</span> <span class="s">)</span><span class="sc">;</span>
        <span class="k">my</span> <span class="i">$temp</span> = <span class="i">$UserValues</span>{<span class="i">$var</span>} = <span class="i">$value</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">foreach</span> <span class="s">(</span><span class="i">@atts</span><span class="s">)</span> <span class="s">{</span>
        <span class="k">unshift</span> <span class="i">@response</span><span class="cm">,</span> <span class="i">$UserValues</span>{<span class="i">$_</span>}<span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span> <span class="k">wantarray</span><span class="s">(</span><span class="s">)</span> ? <span class="i">@response</span> <span class="co">:</span> <span class="i">$response</span>[<span class="n">0</span>]<span class="sc">;</span>
<span class="s">}</span>

<span class="c">#_____________________________________________________________________________</span>

<a name="__END__-"></a><span class="k">__END__</span>

</pre><pre><a name="EOF-"></a></pre>    </BODY>

    </HTML>
