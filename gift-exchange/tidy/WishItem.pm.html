<!-- Generated by perltidy on Mon Jan 20 23:47:08 2003 -->
    <HTML> 
	<HEAD> 
	    <TITLE>WishItem.pm - module to manage a WishItem

</TITLE> 
	</HEAD>

<style type="text/css">
<!--
/* default style sheet generated by perltidy */
body {background: #FFFFFF; color: #000000}
pre { color: #000000; 
      background: #FFFFFF;
      font-family: courier;
    } 

.c  { color: #228B22;} /* comment */
.cm { color: #000000;} /* comma */
.co { color: #000000;} /* colon */
.h  { color: #CD5555; font-weight:bold;} /* here-doc-target */
.hh { color: #CD5555; font-style:italic;} /* here-doc-text */
.i  { color: #00688B;} /* identifier */
.j  { color: #CD5555; font-weight:bold;} /* label */
.k  { color: #8B008B; font-weight:bold;} /* keyword */
.m  { color: #FF0000; font-weight:bold;} /* subroutine */
.n  { color: #B452CD;} /* numeric */
.p  { color: #000000;} /* paren */
.pd { color: #228B22; font-style:italic;} /* pod-text */
.pu { color: #000000;} /* punctuation */
.q  { color: #CD5555;} /* quote */
.s  { color: #000000;} /* structure */
.sc { color: #000000;} /* semicolon */
.v  { color: #B452CD;} /* v-string */
.w  { color: #000000;} /* bareword */
-->
</style>
	<BODY>
<a name="-top-"></a>
<h1>WishItem.pm</h1>

<!-- INDEX BEGIN -->

<UL>

	<LI><A HREF="#NAME">NAME</A>
	<LI><A HREF="#VERSION">VERSION</A>
	<LI><A HREF="#SYNOPSIS">SYNOPSIS</A>
	<LI><A HREF="#DESCRIPTION">DESCRIPTION</A>
	<UL>

		<LI><A HREF="#Overview">Overview</A>
		<LI><A HREF="#Constructor_and_initialization">Constructor and initialization</A>
		<LI><A HREF="#Class_and_object_methods">Class and object methods</A>
		<LI><A HREF="#Any_other_information_that_s_imp">Any other information that's important</A>
	</UL>

	<LI><A HREF="#ENVIRONMENT">ENVIRONMENT</A>
	<LI><A HREF="#DIAGNOSTICS">DIAGNOSTICS</A>
	<LI><A HREF="#ENHANCEMENTS">ENHANCEMENTS</A>
	<LI><A HREF="#REFACTORINGS">REFACTORINGS</A>
	<LI><A HREF="#BUGS">BUGS</A>
	<LI><A HREF="#FILES">FILES</A>
	<LI><A HREF="#SEE_ALSO">SEE ALSO</A>
	<LI><A HREF="#AUTHOR">AUTHOR</A>
	<LI><A HREF="#COPYRIGHT">COPYRIGHT</A>
</UL>
<!-- INDEX END -->
<h2>Code Index:</h2>
<!-- BEGIN CODE INDEX --><a name="code-index"></a>
<ul>
<li><a href="#package-Christmas::Wishlist::WishItem-">package Christmas::Wishlist::WishItem</a>
<ul>
<li><a href="#new-">new</a></li>
<li><a href="#_init-">_init</a></li>
<li><a href="#by-">by</a></li>
<li><a href="#for-">for</a></li>
<li><a href="#requested-">requested</a></li>
<li><a href="#description-">description</a></li>
<li><a href="#_date_from_time-">_date_from_time</a></li>
<li><a href="#_time_from_date-">_time_from_date</a></li>
<li><a href="#expiration_seconds-">expiration_seconds</a></li>
<li><a href="#expiration_date-">expiration_date</a></li>
<li><a href="#ident-">ident</a></li>
<li><a href="#wanted-">wanted</a></li>
<li><a href="#buy-">buy</a></li>
<li><a href="#purchased_by-">purchased_by</a></li>
<li><a href="#notes-">notes</a></li>
<li><a href="#obsolete-">obsolete</a></li>
<li><a href="#deleted-">deleted</a></li>
<li><a href="#bought-">bought</a></li>
</ul>
</li>
<li><a href="#__END__-">__END__</a></li>
<li><a href="#EOF-">EOF</a></li>
</ul>
<!-- END CODE INDEX -->

<HR>

<P>
<HR>
<H1><A NAME="NAME">NAME

</A></H1>
WishItem.pm - module to manage a WishItem


<P>

<P>
<HR>
<H1><A NAME="VERSION">VERSION

</A></H1>
This document refers to version 0.80 of WishItem.pm, released Jan 1, 2003.


<P>

<P>
<HR>
<H1><A NAME="SYNOPSIS">SYNOPSIS

</A></H1>
<PRE>    include Christmas::Wishlist::WishItem;
</PRE>

<P>

<PRE>    $wi = Christmas::Wishlist::WishItem-&gt;new( 
            for=&gt;&lt;recipient&gt;, 
            by=&gt;&lt;creator&gt;, 
            [description=&gt;&lt;descript&gt;]
            [ident=&gt;&lt;identifier&gt;]
            [requested=&gt;&lt;number&gt;]
            [bought=&gt;&lt;number&gt;]
            [expires=&gt;&lt;date&gt;]
    );
</PRE>

<P>

<PRE>    $by   = $wi-&gt;by([&lt;newcreator&gt;];
    $for  = $wi-&gt;for([&lt;newrecipient&gt;]);
    $req  = $wi-&gt;requested([&lt;newnumber&gt;]);
    $dsc  = $wi-&gt;description([&lt;newdescription&gt;]);
    $exp  = $wi-&gt;expiration_date([&lt;date&gt;|never]);
    $exp  = $wi-&gt;expiration_seconds([&lt;epochseconds&gt;]);
    $id   = $wi-&gt;ident([&lt;newidentifier]);
    $wtd  = $wi-&gt;wanted();
    $buy  = $wi-&gt;buy(&lt;howman&gt;, [&lt;note&gt;,] [&lt;buyer&gt;]);
    $bool = $wi-&gt;purchased_by(&lt;buyertocheck&gt;)
    @note = $wi-&gt;notes();
    $bool = $wi-&gt;obsolete();
    $bool = $wi-&gt;deleted([&lt;booldelete&gt;]);
    $num  = $wi-&gt;bought();
</PRE>

<P>

<P>
<HR>
<H1><A NAME="DESCRIPTION">DESCRIPTION

</A></H1>
<P>
<HR>
<H2><A NAME="Overview">Overview

</A></H2>
<P>
<HR>
<H2><A NAME="Constructor_and_initialization">Constructor and initialization

</A></H2>
<P>
<HR>
<H2><A NAME="Class_and_object_methods">Class and object methods

</A></H2>
<P>
<HR>
<H2><A NAME="Any_other_information_that_s_imp">Any other information that's important

</A></H2>
<P>
<HR>
<H1><A NAME="ENVIRONMENT">ENVIRONMENT

</A></H1>
<P>
<HR>
<H1><A NAME="DIAGNOSTICS">DIAGNOSTICS

</A></H1>
<DL>
<DT><STRONG><A NAME="item__error">"error message that may appear"

</A></STRONG><DD>
Explanation of error message


<P>

</DL>
<P>
<HR>
<H1><A NAME="ENHANCEMENTS">ENHANCEMENTS

</A></H1>
Make Notes specific to the Noter.


<P>

Make a Purchase an Included object. (Create a new Object Type.)


<P>

<P>
<HR>
<H1><A NAME="REFACTORINGS">REFACTORINGS

</A></H1>
<P>
<HR>
<H1><A NAME="BUGS">BUGS

</A></H1>
<P>
<HR>
<H1><A NAME="FILES">FILES

</A></H1>
<P>
<HR>
<H1><A NAME="SEE_ALSO">SEE ALSO

</A></H1>
<P>
<HR>
<H1><A NAME="AUTHOR">AUTHOR

</A></H1>
Michael G. Birdsall


<P>

<P>
<HR>
<H1><A NAME="COPYRIGHT">COPYRIGHT

</A></H1>
Copyright (c) 2002, Michael G. Birdsall. All Rights Reserved. This module
is free software. It may be used, redistributed and/or modified under the
same terms as Perl itself.


<P>

</DL>
<hr /><pre>#!/usr/local/bin/perl -w
<span class="c">#</span>
<span class="c"># Module to manage user wishlist item objects.</span>
<span class="c"># WishItems can be (have the methods):</span>
<span class="c"># new       -&gt; get or create the wishlist for a particular person</span>
<span class="c"># buy       -&gt; mark some items as bought</span>
<span class="c"># by        -&gt; Return the user who created the item</span>
<span class="c"># for       -&gt; return the person the item is intended for</span>
<span class="c"># requested -&gt; set and/or return the number of this item requested</span>
<span class="c"># description -&gt; set and/or return the description of the item </span>

<span class="c">#</span>
<span class="c"># Attributes to add to the object:</span>
<span class="c"># _last_update</span>
<span class="c"># _purchasers</span>
<a name="package-Christmas::Wishlist::WishItem-"></a><span class="k">package </span><span class="i">Christmas::Wishlist::WishItem</span><span class="sc">;</span>

<span class="k">use</span> <span class="w">Data::Dumper</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">Time::Local</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">Carp</span><span class="sc">;</span>
<span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>

<span class="k">my</span> <span class="i">%valid_param</span> =
  <span class="k">map</span> <span class="s">{</span> <span class="i">$_</span> <span class="cm">=&gt;</span> <span class="n">1</span> <span class="s">}</span> <span class="q">qw(for by description ident requested bought expires)</span><span class="sc">;</span>

<span class="c">#_____________________________________________________________________________</span>
<a name="new-"></a><span class="k">sub </span><span class="m">new</span>
<span class="s">{</span>
    <span class="k">my</span> <span class="i">$class</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="i">$class</span> = <span class="k">ref</span><span class="s">(</span><span class="i">$class</span><span class="s">)</span> || <span class="i">$class</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$self</span> = <span class="k">bless</span> <span class="s">{</span><span class="s">}</span><span class="cm">,</span> <span class="i">$class</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">$self</span><span class="i">-&gt;_init</span><span class="s">(</span><span class="i">@_</span><span class="s">)</span><span class="sc">;</span>
<span class="s">}</span>

<a name="_init-"></a><span class="k">sub </span><span class="m">_init</span>
<span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$self</span><span class="cm">,</span> <span class="i">%arg</span> <span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="c"># Check for &quot;extra&quot; parameters</span>

    <span class="k">foreach</span> <span class="k">my</span> <span class="i">$param</span> <span class="s">(</span> <span class="k">keys</span> <span class="i">%arg</span> <span class="s">)</span> <span class="s">{</span>
        <span class="k">return</span> <span class="k">unless</span> <span class="k">defined</span> <span class="i">$valid_param</span>{<span class="i">$param</span>}<span class="sc">;</span>
    <span class="s">}</span>

    <span class="i">%$self</span> = <span class="s">(</span>
        <span class="w">_for</span>         <span class="cm">=&gt;</span> <span class="i">$arg</span>{<span class="w">for</span>}         || <span class="k">return</span><span class="cm">,</span>
        <span class="w">_creator</span>     <span class="cm">=&gt;</span> <span class="i">$arg</span>{<span class="w">by</span>}          || <span class="k">return</span><span class="cm">,</span>
        <span class="w">_description</span> <span class="cm">=&gt;</span> <span class="i">$arg</span>{<span class="w">description</span>} || <span class="q">&quot;No Description&quot;</span><span class="cm">,</span>
        <span class="w">_ident</span>       <span class="cm">=&gt;</span> <span class="i">$arg</span>{<span class="w">ident</span>}       || <span class="q">&quot;&quot;</span><span class="cm">,</span>
        <span class="w">_requested</span>   <span class="cm">=&gt;</span> <span class="i">$arg</span>{<span class="w">requested</span>}   || <span class="q">&quot;any&quot;</span><span class="cm">,</span>
        <span class="w">_bought</span>      <span class="cm">=&gt;</span> <span class="i">$arg</span>{<span class="w">bought</span>}      || <span class="n">0</span><span class="cm">,</span>
        <span class="w">_deleted</span>     <span class="cm">=&gt;</span> <span class="n">0</span><span class="cm">,</span>
        <span class="w">_notes</span>       <span class="cm">=&gt;</span> <span class="s">[</span><span class="s">]</span><span class="cm">,</span>
        <span class="w">_purchasers</span>  <span class="cm">=&gt;</span> <span class="s">{</span><span class="s">}</span><span class="cm">,</span>
        <span class="w">_expires</span>     <span class="cm">=&gt;</span> <span class="i">$arg</span>{<span class="w">expires</span>}     || <span class="q">&quot;never&quot;</span><span class="cm">,</span>
        <span class="w">_purchases</span>   <span class="cm">=&gt;</span> <span class="s">[</span><span class="s">]</span><span class="cm">,</span>
        <span class="w">_obsolete</span>    <span class="cm">=&gt;</span> <span class="n">0</span><span class="cm">,</span>
    <span class="s">)</span><span class="sc">;</span>

    <span class="k">return</span> <span class="i">$self</span><span class="sc">;</span>

<span class="s">}</span>

<span class="c">#_____________________________________________________________________________</span>

<a name="by-"></a><span class="k">sub </span><span class="m">by</span>
<span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$self</span><span class="cm">,</span> <span class="i">$creator</span> <span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">_creator</span>} = <span class="i">$creator</span> <span class="k">if</span> <span class="k">defined</span> <span class="i">$creator</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">$self</span>-&gt;{<span class="w">_creator</span>}<span class="sc">;</span>
<span class="s">}</span>

<a name="for-"></a><span class="k">sub </span><span class="m">for</span>
<span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$self</span><span class="cm">,</span> <span class="i">$for</span> <span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">_for</span>} = <span class="i">$for</span> <span class="k">if</span> <span class="k">defined</span> <span class="i">$for</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">$self</span>-&gt;{<span class="w">_for</span>}<span class="sc">;</span>
<span class="s">}</span>

<a name="requested-"></a><span class="k">sub </span><span class="m">requested</span>
<span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$self</span><span class="cm">,</span> <span class="i">$requested</span> <span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">_requested</span>} = <span class="i">$requested</span> <span class="k">if</span> <span class="k">defined</span> <span class="i">$requested</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">$self</span>-&gt;{<span class="w">_requested</span>}<span class="sc">;</span>
<span class="s">}</span>

<a name="description-"></a><span class="k">sub </span><span class="m">description</span>
<span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$self</span><span class="cm">,</span> <span class="i">$description</span> <span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">_description</span>} = <span class="i">$description</span> <span class="k">if</span> <span class="k">defined</span> <span class="i">$description</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">$self</span>-&gt;{<span class="w">_description</span>}<span class="sc">;</span>
<span class="s">}</span>

<span class="c">#_____________________________________________________________________________</span>
<span class="c">#</span>
<span class="c"># date_from_time returns the month, day, year for the passed in integer seconds </span>
<span class="c"># from start of epoch</span>
<span class="c">#</span>
<a name="_date_from_time-"></a><span class="k">sub </span><span class="m">_date_from_time</span>
<span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$epochsec</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$dd</span><span class="cm">,</span> <span class="i">$mmm</span><span class="cm">,</span> <span class="i">$yyyy</span> <span class="s">)</span> = <span class="s">(</span> <span class="k">localtime</span><span class="s">(</span><span class="i">$epochsec</span><span class="s">)</span> <span class="s">)</span>[ <span class="n">3</span><span class="cm">,</span> <span class="n">4</span><span class="cm">,</span> <span class="n">5</span> ]<span class="sc">;</span>
    <span class="i">$yyyy</span> += <span class="n">1900</span><span class="sc">;</span>
    <span class="i">$mmm</span> = <span class="s">(</span>
        <span class="q">&quot;Jan&quot;</span><span class="cm">,</span> <span class="q">&quot;Feb&quot;</span><span class="cm">,</span> <span class="q">&quot;Mar&quot;</span><span class="cm">,</span> <span class="q">&quot;Apr&quot;</span><span class="cm">,</span> <span class="q">&quot;May&quot;</span><span class="cm">,</span> <span class="q">&quot;Jun&quot;</span><span class="cm">,</span>
        <span class="q">&quot;Jul&quot;</span><span class="cm">,</span> <span class="q">&quot;Aug&quot;</span><span class="cm">,</span> <span class="q">&quot;Sep&quot;</span><span class="cm">,</span> <span class="q">&quot;Oct&quot;</span><span class="cm">,</span> <span class="q">&quot;Nov&quot;</span><span class="cm">,</span> <span class="q">&quot;Dec&quot;</span>
    <span class="s">)</span>[<span class="i">$mmm</span>]<span class="sc">;</span>
    <span class="k">return</span> <span class="q">&quot;$mmm $dd $yyyy&quot;</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#</span>
<span class="c"># time_from_date returns the integer seconds from start of epoch</span>
<span class="c"># for the passed in month, day, year</span>
<span class="c">#</span>
<a name="_time_from_date-"></a><span class="k">sub </span><span class="m">_time_from_date</span>
<span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$mmm</span><span class="cm">,</span> <span class="i">$dd</span><span class="cm">,</span> <span class="i">$yyyy</span> <span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%month_vals</span> = <span class="s">(</span>
        <span class="w">Jan</span> <span class="cm">=&gt;</span> <span class="n">0</span><span class="cm">,</span>
        <span class="w">Feb</span> <span class="cm">=&gt;</span> <span class="n">1</span><span class="cm">,</span>
        <span class="w">Mar</span> <span class="cm">=&gt;</span> <span class="n">2</span><span class="cm">,</span>
        <span class="w">Apr</span> <span class="cm">=&gt;</span> <span class="n">3</span><span class="cm">,</span>
        <span class="w">May</span> <span class="cm">=&gt;</span> <span class="n">4</span><span class="cm">,</span>
        <span class="w">Jun</span> <span class="cm">=&gt;</span> <span class="n">5</span><span class="cm">,</span>
        <span class="w">Jul</span> <span class="cm">=&gt;</span> <span class="n">6</span><span class="cm">,</span>
        <span class="w">Aug</span> <span class="cm">=&gt;</span> <span class="n">7</span><span class="cm">,</span>
        <span class="w">Sep</span> <span class="cm">=&gt;</span> <span class="n">8</span><span class="cm">,</span>
        <span class="w">Oct</span> <span class="cm">=&gt;</span> <span class="n">9</span><span class="cm">,</span>
        <span class="w">Nov</span> <span class="cm">=&gt;</span> <span class="n">10</span><span class="cm">,</span>
        <span class="w">Dec</span> <span class="cm">=&gt;</span> <span class="n">11</span><span class="cm">,</span>
    <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$month_val</span> = <span class="i">$month_vals</span>{<span class="i">$mmm</span>}<span class="sc">;</span>
    <span class="k">return</span> <span class="i">timelocal</span><span class="s">(</span> <span class="n">0</span><span class="cm">,</span> <span class="n">0</span><span class="cm">,</span> <span class="n">0</span><span class="cm">,</span> <span class="i">$dd</span><span class="cm">,</span> <span class="i">$month_val</span><span class="cm">,</span> <span class="i">$yyyy</span> - <span class="n">1900</span> <span class="s">)</span><span class="sc">;</span>
<span class="s">}</span>

<span class="c">#_____________________________________________________________________________</span>
<a name="expiration_seconds-"></a><span class="k">sub </span><span class="m">expiration_seconds</span>
<span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$self</span><span class="cm">,</span> <span class="i">$expires</span> <span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">%month</span> = <span class="k">map</span> <span class="s">{</span> <span class="i">$_</span> <span class="cm">=&gt;</span> <span class="n">1</span> <span class="s">}</span> <span class="s">(</span>
        <span class="q">&quot;Jan&quot;</span><span class="cm">,</span> <span class="q">&quot;Feb&quot;</span><span class="cm">,</span> <span class="q">&quot;Mar&quot;</span><span class="cm">,</span> <span class="q">&quot;Apr&quot;</span><span class="cm">,</span> <span class="q">&quot;May&quot;</span><span class="cm">,</span> <span class="q">&quot;Jun&quot;</span><span class="cm">,</span>
        <span class="q">&quot;Jul&quot;</span><span class="cm">,</span> <span class="q">&quot;Aug&quot;</span><span class="cm">,</span> <span class="q">&quot;Sep&quot;</span><span class="cm">,</span> <span class="q">&quot;Oct&quot;</span><span class="cm">,</span> <span class="q">&quot;Nov&quot;</span><span class="cm">,</span> <span class="q">&quot;Dec&quot;</span>
    <span class="s">)</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$expires</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">_expires</span>} = <span class="i">_date_from_time</span><span class="s">(</span><span class="i">$expires</span><span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span> <span class="k">unless</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$self</span>-&gt;{<span class="w">_expires</span>} <span class="s">)</span><span class="sc">;</span>
    <span class="k">return</span> <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">_expires</span>} <span class="k">eq</span> <span class="q">&quot;never&quot;</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">return</span> <span class="k">unless</span> <span class="s">(</span> <span class="i">$self</span>-&gt;{<span class="w">_expires</span>} =~ <span class="q">/(\w{3}) \d{1,2} \d{4}/</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">return</span> <span class="k">unless</span> <span class="k">exists</span> <span class="i">$month</span>{<span class="i">$1</span>}<span class="sc">;</span>
    <span class="k">return</span> <span class="i">_time_from_date</span><span class="s">(</span> <span class="k">split</span> <span class="q">&quot; &quot;</span><span class="cm">,</span> <span class="i">$self</span>-&gt;{<span class="w">_expires</span>} <span class="s">)</span><span class="sc">;</span>

<span class="s">}</span>

<a name="expiration_date-"></a><span class="k">sub </span><span class="m">expiration_date</span>
<span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$self</span><span class="cm">,</span> <span class="i">$expires</span> <span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="i">$self</span>-&gt;{<span class="w">_expires</span>} = <span class="i">$expires</span> <span class="k">if</span> <span class="k">defined</span> <span class="i">$expires</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">$self</span>-&gt;{<span class="w">_expires</span>}<span class="sc">;</span>
<span class="s">}</span>

<a name="ident-"></a><span class="k">sub </span><span class="m">ident</span>
<span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">$self</span>-&gt;{<span class="w">_ident</span>}<span class="sc">;</span>
<span class="s">}</span>

<a name="wanted-"></a><span class="k">sub </span><span class="m">wanted</span>
<span class="s">{</span>
    <span class="k">return</span> <span class="k">if</span> <span class="s">(</span> <span class="k">scalar</span> <span class="i">@_</span> &gt; <span class="n">1</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span> = <span class="k">shift</span><span class="sc">;</span>
    <span class="k">return</span> <span class="q">&quot;any&quot;</span> <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span><span class="i">-&gt;requested</span> <span class="k">eq</span> <span class="q">&quot;any&quot;</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">return</span> <span class="q">&quot;error&quot;</span> <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span><span class="i">-&gt;requested</span> !~ <span class="q">/^\d+$/</span> <span class="s">)</span><span class="sc">;</span>

    <span class="k">return</span> <span class="i">$self</span><span class="i">-&gt;requested</span> - <span class="i">$self</span>-&gt;{<span class="w">_bought</span>}<span class="sc">;</span>
<span class="s">}</span>

<a name="buy-"></a><span class="k">sub </span><span class="m">buy</span>
<span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$self</span><span class="cm">,</span> <span class="i">$num</span><span class="cm">,</span> <span class="i">$descrip</span><span class="cm">,</span> <span class="i">$buyer</span> <span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span><span class="i">-&gt;requested</span> !~ <span class="q">/^\d+$/</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">_bought</span>} += <span class="i">$num</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">_purchasers</span>}-&gt;{<span class="i">$buyer</span>} += <span class="i">$num</span> <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$buyer</span> <span class="s">)</span><span class="sc">;</span>
        <span class="k">push</span> <span class="s">(</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="w">_notes</span>} }<span class="cm">,</span> <span class="i">$descrip</span> <span class="s">)</span> <span class="k">if</span> <span class="i">$descrip</span><span class="sc">;</span>
        <span class="k">return</span> <span class="q">&quot;any&quot;</span><span class="sc">;</span>
    <span class="s">}</span> <span class="k">elsif</span> <span class="s">(</span> <span class="i">$self</span><span class="i">-&gt;wanted</span> &gt;= <span class="i">$num</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">_bought</span>} += <span class="i">$num</span><span class="sc">;</span>
        <span class="i">$self</span>-&gt;{<span class="w">_purchasers</span>}-&gt;{<span class="i">$buyer</span>} += <span class="i">$num</span> <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$buyer</span> <span class="s">)</span><span class="sc">;</span>
        <span class="k">push</span> <span class="s">(</span> <span class="i">@</span>{ <span class="i">$self</span>-&gt;{<span class="w">_notes</span>} }<span class="cm">,</span> <span class="i">$descrip</span> <span class="s">)</span> <span class="k">if</span> <span class="i">$descrip</span><span class="sc">;</span>
        <span class="k">return</span> <span class="i">$num</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span><span class="sc">;</span>
<span class="s">}</span>

<a name="purchased_by-"></a><span class="k">sub </span><span class="m">purchased_by</span>
<span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$self</span><span class="cm">,</span> <span class="i">$caller</span> <span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>

    <span class="k">return</span> <span class="i">$self</span>-&gt;{<span class="w">_purchasers</span>}-&gt;{<span class="i">$caller</span>}<span class="sc">;</span>
<span class="s">}</span>

<a name="notes-"></a><span class="k">sub </span><span class="m">notes</span>
<span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">$self</span>-&gt;{<span class="w">_notes</span>}<span class="sc">;</span>
<span class="s">}</span>

<a name="obsolete-"></a><span class="k">sub </span><span class="m">obsolete</span>
<span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">return</span> <span class="n">0</span> <span class="k">if</span> <span class="s">(</span> <span class="i">$self</span><span class="i">-&gt;expiration_date</span><span class="s">(</span><span class="s">)</span> <span class="k">eq</span> <span class="q">&quot;never&quot;</span> <span class="s">)</span><span class="sc">;</span>
    <span class="k">my</span> <span class="i">$secs</span> = <span class="i">$self</span><span class="i">-&gt;expiration_seconds</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
    <span class="k">return</span> <span class="k">unless</span> <span class="k">defined</span> <span class="i">$secs</span><span class="sc">;</span>
    <span class="k">return</span> <span class="s">(</span> <span class="i">$self</span><span class="i">-&gt;expiration_seconds</span><span class="s">(</span><span class="s">)</span> &lt; <span class="k">time</span><span class="s">(</span><span class="s">)</span> <span class="s">)</span><span class="sc">;</span>
<span class="s">}</span>

<a name="deleted-"></a><span class="k">sub </span><span class="m">deleted</span>
<span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span> <span class="i">$self</span><span class="cm">,</span> <span class="i">$delete</span> <span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">if</span> <span class="s">(</span> <span class="k">defined</span> <span class="i">$delete</span> <span class="s">)</span> <span class="s">{</span>
        <span class="i">$self</span>-&gt;{<span class="w">_deleted</span>} = <span class="i">$delete</span><span class="sc">;</span>
        <span class="i">$self</span><span class="i">-&gt;requested</span><span class="s">(</span><span class="n">0</span><span class="s">)</span><span class="sc">;</span>
    <span class="s">}</span>
    <span class="k">return</span> <span class="i">$self</span>-&gt;{<span class="w">_deleted</span>}<span class="sc">;</span>
<span class="s">}</span>

<a name="bought-"></a><span class="k">sub </span><span class="m">bought</span>
<span class="s">{</span>
    <span class="k">my</span> <span class="s">(</span><span class="i">$self</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
    <span class="k">return</span> <span class="i">$self</span>-&gt;{<span class="w">_bought</span>}<span class="sc">;</span>
<span class="s">}</span>

<span class="n">1</span><span class="sc">;</span>

<span class="c">#_____________________________________________________________________________</span>

<a name="__END__-"></a><span class="k">__END__</span>

</pre><pre><a name="EOF-"></a></pre>    </BODY>

    </HTML>
